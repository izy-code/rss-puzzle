"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[583],{514:(W,w,b)=>{b.d(w,{A:()=>B});var g=b(256);function B({className:S,textContent:T="",buttonType:E="button",clickHandler:z}){return new g.A({tag:"button",className:S,textContent:T,type:E,onclick:z})}},583:(W,w,b)=>{b.r(w),b.d(w,{default:()=>ee});var g=b(256),B=Object.defineProperty,S=(i,e,t)=>e in i?B(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,T=(i,e,t)=>(S(i,typeof e!="symbol"?e+"":e,t),t);const E="https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/";class z{constructor(e){T(this,"url"),T(this,"pages",[]),this.url=`${E}/data/wordCollectionLevel${e+1}.json`}loadPages(){return fetch(this.url).then(e=>{if(!e.ok)throw new Error(`Failed to load JSON: ${e.statusText}`);return e.json()}).then(e=>{this.pages=e.rounds})}getPagesCount(){return this.pages.length}getPageData(e){var t;const r=(t=this.pages[e])==null?void 0:t.levelData;if(!r)throw new Error(`Can't find data for page number ${e}`);return r}getSentences(e){var t;const r=(t=this.pages[e])==null?void 0:t.words;if(!r)throw new Error(`Can't find sentences for page number ${e}`);return r}}var C=b(734),I=Object.defineProperty,$=(i,e,t)=>e in i?I(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,N=(i,e,t)=>($(i,typeof e!="symbol"?e+"":e,t),t);class P extends g.A{constructor(e,t,r){super({className:"card",tag:"div"}),N(this,"orderNumber"),N(this,"relativeWidth",.1),N(this,"isRightPlace",!1),N(this,"parentPlace",new g.A({})),N(this,"textContainer"),this.textContainer=(0,C.Ln)({className:"card__text",textContent:e}),this.orderNumber=t,this.addClasses(r),this.append(this.textContainer)}getOrder(){return this.orderNumber}getRelativeWidth(){return this.relativeWidth}setRelativeWidth(e){this.relativeWidth=e}getParentPlace(){return this.parentPlace}setParentPlace(e){this.parentPlace=e}getIsRightPlace(){return this.isRightPlace}setIsRightPlace(e){this.isRightPlace=e}}function k(i){if(i===void 0)throw new Error("Value not defined");if(i===null)throw new Error("Value is null")}function ne(i){return i!=null}function H(i,e){if(k(i),!(i instanceof e))throw new TypeError("Wrong object type")}const re=(i,e,t)=>{const r=i.querySelector(e);return H(r,t),r},x=(i,e)=>{const{target:t}=i;return t instanceof HTMLElement?t.closest(e):null},O=(i,e,t)=>{i.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:t}))};var v=b(514),y=b(182),Y=Object.defineProperty,U=(i,e,t)=>e in i?Y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,a=(i,e,t)=>(U(i,typeof e!="symbol"?e+"":e,t),t);const A=600,V=100,R=1500,X=100,D=class L extends g.A{constructor(e,t,r,l,h){super({className:"puzzle-page__main main",tag:"main"}),a(this,"router"),a(this,"storage"),a(this,"sentences"),a(this,"currentSentenceNumber",0),a(this,"listeners",{}),a(this,"sentenceTranslation"),a(this,"pronounceButton"),a(this,"rows"),a(this,"board"),a(this,"source",(0,C.y4)({className:"main__source main__source--start"})),a(this,"currentRow",new g.A({})),a(this,"checkButton",(0,v.A)({className:"main__check-button button",textContent:"Check",buttonType:"button"})),a(this,"completeButton",(0,v.A)({className:"main__check-button button button--cancel",textContent:"Auto-Complete",buttonType:"button"})),a(this,"cards",[]),a(this,"resizeObserver",null),a(this,"isCardsSizeSet",!1),a(this,"pageNumber"),a(this,"levelNumber"),a(this,"draggedCardNode",null),a(this,"currentDropPlace",null),a(this,"isFirstSentenceLoad",!0),a(this,"createCardMovementCurryHandler",n=>o=>{const s=this.findMovedCardComponent(o);if(!s)return;const c=n.getChildren();for(let d=0;d<c.length;d+=1){const p=c[d];if(p instanceof g.A&&!p.hasChildren()){p.append(s),s.setParentPlace(p),p.hasClass("main__row-place")?(p.addClass("main__row-place--full"),s.setIsRightPlace(d===s.getOrder()),this.isRowFilled()&&this.checkButton.removeAttribute("disabled")):s.setIsRightPlace(!1);break}}}),a(this,"onCheckButtonClick",()=>{const n=this.currentRow.getChildren();let o=!0;for(let s=0;s<n.length;s+=1){const c=n[s];if(!(c instanceof g.A))throw new Error("Wrong place type");const d=c.getChildren()[0];if(!(d instanceof P))throw new TypeError("Wrong card type");d.getIsRightPlace()?d.addClass("card--right"):(d.addClass("card--wrong"),o=!1)}o&&this.onSentenceInRightOrder()}),a(this,"handleFilledSentencesResize",n=>{for(let o=0;o<this.currentSentenceNumber;o+=1){const s=this.rows[o];let c=0;s==null||s.getChildren().forEach(d=>{if(!(d instanceof g.A))throw new TypeError("Wrong place type");const p=d.getChildren()[0];if(!(p instanceof P))throw new TypeError("Wrong card type");const f=Math.floor(n*p.getRelativeWidth());p.getNode().style.width=`${f}px`,c+=f,(s==null?void 0:s.getChildren().at(-1))===d&&(p.getNode().style.width=`${f+(n-c)}px`)})}}),a(this,"onContinueButtonClick",()=>{if(this.currentSentenceNumber===this.sentences.length-1){this.router.navigate(`${y.b.PUZZLE}-${this.levelNumber+1}-${this.pageNumber+2}`);return}this.removeCardsClasses(),this.currentSentenceNumber+=1,this.checkButton.setAttribute("disabled",""),this.completeButton.removeAttribute("disabled"),this.checkButton.setTextContent("Check"),this.checkButton.removeClass("button--continue"),this.checkButton.addListener("click",this.onCheckButtonClick),this.checkButton.removeListener("click",this.onContinueButtonClick),setTimeout(()=>this.handleNewSentenceShow(this.currentSentenceNumber),V)}),a(this,"onCompleteButtonClick",()=>{let n=0;for(let o=0;o<this.cards.length;o+=1){const s=this.cards[o];if(!(s instanceof P))throw new TypeError("Wrong card type");this.moveCardToRightPlace(s,n),n+=s.getNode().offsetWidth}this.completeButton.setAttribute("disabled",""),this.changeSourcePlacesWidth(),this.removeCardsClasses(),setTimeout(()=>{this.checkButton.removeAttribute("disabled"),this.onSentenceInRightOrder()},R+X)}),a(this,"moveCardToRightPlace",(n,o)=>{const s=this.currentRow.getChildren()[n.getOrder()];if(!(s instanceof g.A))throw new Error("Can't find place");n.getIsRightPlace()&&this.moveCardToTargetPlace(n,null,o),this.moveCardToTargetPlace(n,s,o)}),a(this,"moveCardToTargetPlace",(n,o,s)=>{const c=n.getNode(),d=c.getBoundingClientRect(),p=this.currentRow.getNode().getBoundingClientRect(),f=p.left+s-d.left,_=p.top-d.top;c.style.transition=`transform ${R}ms, background-color ${R}ms`,c.style.transform=`translate(${f}px, ${_}px`,c.addEventListener("transitionend",()=>{c.style.transform="",o&&(n.getParentPlace().removeChild(n),o.addClass("main__row-place--full"),o.append(n),n.setParentPlace(o))},{once:!0})}),a(this,"changeSourcePlacesWidth",()=>{const n=this.source.getChildren();for(let o=0;o<n.length;o+=1){const s=n[o];if(!(s instanceof g.A))throw new TypeError("Wrong place type");s.getNode().style.width=`${s.getNode().offsetWidth}px`,setTimeout(()=>{s.getNode().style.width="40px"},R)}}),a(this,"cursorDragHandler",n=>{const o=n instanceof MouseEvent?"mouseup":"touchend",s=n instanceof MouseEvent?"mousemove":"touchmove",c=this.createInitialCursorMoveHandler(n);document.addEventListener(o,()=>{document.removeEventListener(s,c)},{once:!0}),document.addEventListener(s,c,{once:!0})}),a(this,"createInitialCursorMoveHandler",n=>()=>{const o=n instanceof MouseEvent?n:n.changedTouches[0];if(!o||(this.draggedCardNode=x(o,".card--active"),!this.draggedCardNode))return;const s=this.draggedCardNode.parentElement,c=this.draggedCardNode.getBoundingClientRect(),d=o.clientX-c.left,p=o.clientY-c.top;if(!s)return;const f=this.findPlaceComponentFromNode(s),_=this.cards.find(te=>te.getNode()===this.draggedCardNode);_&&(this.styleAndAppendCard(o,d,p),this.currentDropPlace=null,this.addCursorHandlers(n,d,p,f,_),n instanceof MouseEvent?this.draggedCardNode.style.cursor="grabbing":this.draggedCardNode.style.touchAction="none")}),a(this,"styleAndAppendCard",(n,o,s)=>{this.draggedCardNode&&(this.draggedCardNode.style.position="absolute",this.draggedCardNode.style.zIndex="10",this.draggedCardNode.style.left=`${n.pageX-o}px`,this.draggedCardNode.style.top=`${n.pageY-s}px`,document.body.append(this.draggedCardNode))}),a(this,"addCursorHandlers",(n,o,s,c,d)=>{if(!this.draggedCardNode)return;const p=n instanceof MouseEvent?"mouseup":"touchend",f=n instanceof MouseEvent?"mousemove":"touchmove",_=this.createCursorMoveHandler(o,s);document.addEventListener(f,_),this.draggedCardNode.addEventListener(p,()=>{this.draggedCardNode&&(this.currentDropPlace&&this.currentDropPlace.classList.remove("drop-place--hover"),this.handleDrop(c,d),this.draggedCardNode.style.cursor="",document.removeEventListener(f,_))},{once:!0})}),a(this,"handleDrop",(n,o)=>{!this.draggedCardNode||!n.place||(!this.currentDropPlace||this.currentDropPlace===n.place.getNode()?(n.place.getNode().append(this.draggedCardNode),this.resetDraggedCardStyles()):this.currentDropPlace.hasChildNodes()?this.handleDropToNonEmptyPlace(n,o):this.handleDropToEmptyPlace(n,o))}),a(this,"handleDropToEmptyPlace",(n,o)=>{if(!this.currentDropPlace||!n.place)return;this.resetDraggedCardStyles(),this.removeCardsClasses(),n.place.cleanComponentChildrenList(),n.place.hasClass("main__row-place")&&(n.place.removeClass("main__row-place--full"),this.currentDropPlace.classList.contains("main__source-place")&&this.checkButton.setAttribute("disabled",""));const{place:s,index:c}=this.findPlaceComponentFromNode(this.currentDropPlace);s&&(s.append(o),o.setParentPlace(s),s.hasClass("main__row-place")?(s.addClass("main__row-place--full"),o.setIsRightPlace(c===o.getOrder()),this.isRowFilled()&&this.checkButton.removeAttribute("disabled")):o.setIsRightPlace(!1))}),a(this,"handleDropToNonEmptyPlace",(n,o)=>{if(!this.currentDropPlace||!n.place)return;this.resetDraggedCardStyles(),this.removeCardsClasses(),n.place.cleanComponentChildrenList();const{place:s,index:c}=this.findPlaceComponentFromNode(this.currentDropPlace);if(!s)return;const d=s.getChildren()[0];d instanceof P&&(s.cleanComponentChildrenList(),L.handleCardAdd(s,o,c),L.handleCardAdd(n.place,d,n.index))}),a(this,"findPlaceComponentFromNode",n=>{if(!n)return{place:null,index:-1};if(n.classList.contains("main__row-place")){const o=this.currentRow.getChildren();for(let s=0;s<o.length;s+=1){const c=o[s];if(c instanceof g.A&&c.getNode()===n)return{place:c,index:s}}}else{const o=this.source.getChildren();for(let s=0;s<o.length;s+=1){const c=o[s];if(c instanceof g.A&&c.getNode()===n)return{place:c,index:s}}}return{place:null,index:-1}}),a(this,"createPronounceButton",()=>{const n=(0,v.A)({className:"main__button-pronounce button button--continue",buttonType:"button"}),o=this.createOnPronounceClick(n);return n.addListener("click",o),n}),a(this,"createOnPronounceClick",n=>{const o=()=>{const s=this.sentences[this.currentSentenceNumber];let c=s==null?void 0:s.audioExample;if(!c)return;c=E+c;const d=new Audio(c);d.play().then(()=>{n.addClass("main__button-pronounce--icon-on"),n.removeListener("click",o),d.onended=()=>{n.removeClass("main__button-pronounce--icon-on"),n.addListener("click",o)}}).catch(()=>{})};return o}),this.router=e,this.storage=t,this.pageNumber=h,this.levelNumber=l,this.sentences=r.getSentences(h),this.rows=this.createRows(),this.board=(0,C.y4)({className:"main__board"},...this.rows),this.pronounceButton=this.createPronounceButton(),this.sentenceTranslation=(0,C.p)({className:"main__translation"});const u=(0,C.y4)({className:"main__row-numbers"},...this.createRowNumbers()),m=(0,C.y4)({className:"main__buttons-container"});this.checkButton.setAttribute("disabled",""),m.appendChildren([this.completeButton,this.checkButton]),this.appendChildren([this.pronounceButton,this.sentenceTranslation,u,this.board,this.source,m]),setTimeout(()=>this.handleNewSentenceShow(this.currentSentenceNumber),A),this.checkButton.addListener("click",this.onCheckButtonClick),this.completeButton.addListener("click",this.onCompleteButtonClick),this.initConstructorListeners()}initConstructorListeners(){document.addEventListener("mousedown",this.cursorDragHandler),document.addEventListener("touchstart",this.cursorDragHandler),document.addEventListener("translation-click",()=>{this.storage.getField("isTranslationOn")===!0?this.showTranslation():this.hideTranslation()}),document.addEventListener("pronounce-click",()=>{this.storage.getField("isPronounceOn")===!0?this.showPronounceButton():this.hidePronounceButton()})}handleNewSentenceShow(e){var t;this.source.addClass("main__source--start");const r=this.rows[e];k(r),this.currentRow=r,this.cards=this.createCards(e),this.createCardPlaces(),this.resizeObserver&&this.resizeObserver.disconnect(),this.setCardsWidth(),this.resizeObserver=new ResizeObserver(this.handleBoardResize.bind(this)),(t=this.resizeObserver)==null||t.observe(this.board.getNode()),this.listeners.onSourceClick=this.createCardMovementCurryHandler(this.currentRow),this.listeners.onCurrentRowClick=this.createCardMovementCurryHandler(this.source),this.source.addListener("click",this.listeners.onSourceClick),this.currentRow.addListener("click",this.listeners.onCurrentRowClick),this.cancelCardsDragStart(),this.handleHintsVisibility(),this.isFirstSentenceLoad=!1}handleHintsVisibility(){this.isFirstSentenceLoad&&this.storage.getField("isTranslationOn")===!0?this.showTranslation():this.storage.getField("isTranslationOn")===!0?(this.hideTranslation(),setTimeout(()=>{this.showTranslation()},A)):this.hideTranslation(),this.storage.getField("isPronounceOn")===!0?this.showPronounceButton():this.hidePronounceButton()}createRows(){return this.sentences.map(()=>(0,C.y4)({className:"main__row"}))}createRowNumbers(){return this.sentences.map((e,t)=>(0,C.Ln)({className:"main__row-number",textContent:`${t+1}`}))}createCards(e){var t;const r=(t=this.sentences[e])==null?void 0:t.textExample;if(!r)throw new Error(`Can't find sentence number ${e}`);const l=r.split(" ");l.map((u,m)=>new P(u,m,"main__card card--active"));const h=[];return l.forEach((u,m)=>{const n=new P(u,m,"main__card card--active card--key card--hole");m===0?n.removeClass("card--hole"):m===l.length-1&&n.removeClass("card--key"),h.push(n)}),h}getShuffledCards(){const e=this.cards.slice();for(let t=e.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1)),l=e[t],h=e[r];if(!l||!h)throw new Error(`Can't find card number ${t} or ${r}`);[e[t],e[r]]=[h,l]}return e}createCardPlaces(){this.source.removeChildren(),this.getShuffledCards().forEach(e=>{this.currentRow.append((0,C.y4)({className:"main__row-place drop-place"}));const t=(0,C.y4)({className:"main__source-place drop-place"},e);e.setParentPlace(t),this.source.append(t)})}setCardsWidth(){const e=this.cards.map(r=>r.getNode().offsetWidth),t=this.board.getNode().offsetWidth;this.cards.forEach((r,l)=>{const h=e[l];if(!h)return;const u=r.getNode();u.style.width=`${e[l]}px`,r.setRelativeWidth(h/t)}),this.source.removeClass("main__source--start"),this.isCardsSizeSet=!0}findMovedCardComponent(e){const t=x(e,".main__card");if(!t)return null;const r=this.cards.find(h=>t===h.getNode());if(!r)throw new Error("Can't find card");const l=r.getParentPlace();return l.removeChild(r),this.removeCardsClasses(),l.hasClass("main__row-place")&&(l.removeClass("main__row-place--full"),this.checkButton.setAttribute("disabled","")),r}onSentenceInRightOrder(){this.checkButton.setTextContent("Continue"),this.checkButton.addClass("button--continue"),this.checkButton.removeListener("click",this.onCheckButtonClick),this.checkButton.addListener("click",this.onContinueButtonClick),this.listeners.onSourceClick&&this.listeners.onCurrentRowClick&&(this.source.removeListener("click",this.listeners.onSourceClick),this.currentRow.removeListener("click",this.listeners.onCurrentRowClick)),this.cards.forEach(e=>{e.removeClass("card--active")}),this.currentRow.getChildren().forEach(e=>{e instanceof g.A&&e.removeClass("drop-place")}),this.showTranslation(),this.showPronounceButton()}removeCardsClasses(){this.cards.forEach(e=>{e.removeClass("card--right"),e.removeClass("card--wrong")})}isRowFilled(){const e=this.currentRow.getChildren();for(let t=0;t<e.length;t+=1){const r=e[t];if(!(r instanceof g.A)||!r.hasClass("main__row-place--full"))return!1}return!0}handleBoardResize(e){if(!e[0]||!this.isCardsSizeSet)return;const t=e[0].contentRect.width;this.handleFilledSentencesResize(t);let r=0;this.cards.forEach(l=>{const h=Math.floor(t*l.getRelativeWidth()),u=l.getNode();r+=h,u.style.width=`${h}px`,this.cards.at(-1)===l&&(u.style.width=`${h+(t-r)}px`)})}resetDraggedCardStyles(){this.draggedCardNode&&(this.draggedCardNode.style.position="",this.draggedCardNode.style.cursor="",this.draggedCardNode.style.zIndex="",this.draggedCardNode.style.left="",this.draggedCardNode.style.top="")}createCursorMoveHandler(e,t){return r=>{const l=r instanceof MouseEvent?r:r.changedTouches[0];if(!this.draggedCardNode||!l)return;this.draggedCardNode.style.left=`${l.pageX-e}px`,this.draggedCardNode.style.top=`${l.pageY-t}px`,this.draggedCardNode.style.display="none";const h=document.elementFromPoint(l.clientX,l.clientY);if(this.draggedCardNode.style.display="",!h)return;const u=h.closest(".drop-place");this.currentDropPlace!==u&&(this.currentDropPlace&&(this.currentDropPlace.classList.remove("drop-place--hover"),this.draggedCardNode.style.cursor="grabbing"),this.currentDropPlace=u,this.currentDropPlace&&(this.currentDropPlace.classList.add("drop-place--hover"),this.draggedCardNode.style.cursor="cell"))}}cancelCardsDragStart(){this.cards.forEach(e=>{const t=e.getNode();t.ondragstart=()=>!1})}showTranslation(){const e=this.sentences[this.currentSentenceNumber];e&&this.sentenceTranslation.setTextContent(e.textExampleTranslate),this.sentenceTranslation.addClass("main__translation--opaque")}hideTranslation(){this.sentenceTranslation.removeClass("main__translation--opaque")}showPronounceButton(){this.pronounceButton.addClass("main__button-pronounce--opaque"),this.pronounceButton.addClass("main__button-pronounce--visible")}hidePronounceButton(){this.pronounceButton.removeClass("main__button-pronounce--opaque"),setTimeout(()=>{this.pronounceButton.removeClass("main__button-pronounce--visible")},A)}};a(D,"handleCardAdd",(i,e,t)=>{i.append(e),e.setParentPlace(i),i.hasClass("main__row-place")?e.setIsRightPlace(t===e.getOrder()):e.setIsRightPlace(!1)});let Z=D;var J=Object.defineProperty,q=(i,e,t)=>e in i?J(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,M=(i,e,t)=>(q(i,typeof e!="symbol"?e+"":e,t),t);class K extends g.A{constructor(e,t){super({className:"puzzle-page__header header",tag:"header"}),M(this,"router"),M(this,"storage"),this.router=e,this.storage=t;const r=(0,C.y4)({className:"header__buttons-container"}),l=this.createStartButton(),h=this.createTranslationButton(),u=this.createPronounceButton();r.appendChildren([h,u]),this.appendChildren([l,r])}createTranslationButton(){let e=this.storage.getField("isTranslationOn");(e===null||typeof e!="boolean")&&(e=!0,this.storage.setField("isTranslationOn",!0));const t=(0,C.Ln)({className:"visually-hidden",textContent:`Translation ${e?"on":"off"}`}),r=(0,v.A)({className:`header__translate-button button button--icon button--icon_text-${e?"on":"off"}`});return r.append(t),r.addListener("click",()=>{e=!e,this.storage.setField("isTranslationOn",e),r.toggleClass("button--icon_text-on"),r.toggleClass("button--icon_text-off"),t.setTextContent(e?"Translation on":"Translation off"),O(r.getNode(),"translation-click")}),r}createPronounceButton(){let e=this.storage.getField("isPronounceOn");(e===null||typeof e!="boolean")&&(e=!0,this.storage.setField("isPronounceOn",!0));const t=(0,C.Ln)({className:"visually-hidden",textContent:`Pronounce ${e?"on":"off"}`}),r=(0,v.A)({className:`header__pronounce-button button button--icon button--icon_sound-${e?"on":"off"}`});return r.append(t),r.addListener("click",()=>{e=!e,this.storage.setField("isPronounceOn",e),r.toggleClass("button--icon_sound-on"),r.toggleClass("button--icon_sound-off"),t.setTextContent(e?"Pronounce on":"Pronounce off"),O(r.getNode(),"pronounce-click")}),r}createStartButton(){const e=(0,v.A)({className:"header__start-button button",textContent:"Return to Start Page",buttonType:"button"});return e.addListener("click",()=>{this.router.navigate(y.b.START)}),e}}var G=Object.defineProperty,Q=(i,e,t)=>e in i?G(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,F=(i,e,t)=>(Q(i,typeof e!="symbol"?e+"":e,t),t);const j=5;class ee extends g.A{constructor(e,t,r,l){if(super({className:"app-container__page puzzle-page"}),F(this,"router"),F(this,"storage"),this.router=e,this.storage=t,r<0||r>j){this.router.navigate(y.b.PUZZLE);return}const h=new z(r);h.loadPages().then(()=>{if(l<0||l>=h.getPagesCount()){this.router.navigate(y.b.PUZZLE);return}const u=new K(e,t),m=new Z(e,t,h,r,l);this.appendChildren([u,m])}).catch(u=>{throw new Error(`Failed to load level data: ${u}`)})}}}}]);
